\documentclass[11pt]{article}

\usepackage[left=3cm,right=3cm,top=3cm,bottom=3cm]{geometry}
\usepackage{amssymb,amsmath,amsthm}
\usepackage{mathtools}
\usepackage{enumitem}
\usepackage{tabularx}
\usepackage{tikz-cd}
\usepackage{parskip}

\newcolumntype{Y}{>{\centering\arraybackslash}X}

\DeclarePairedDelimiter\trunc\lVert\rVert

\newcommand{\U}{\mathcal{U}}
\newcommand{\N}{\mathbb{N}}
\newcommand{\Z}{\mathbb{Z}}
\newcommand{\F}{\mathbb{F}}
\newcommand{\id}{\mathsf{id}}
\newcommand{\ap}{\mathsf{ap}}

\newcommand{\Fin}{\mathsf{Fin}}
\newcommand{\refl}{\mathsf{refl}}
\newcommand{\base}{\mathsf{base}}
\newcommand{\Sloop}{\mathsf{loop}}
\newcommand{\ind}{\mathsf{ind}}

\newcommand{\Nsucc}{S}
\newcommand{\Nadd}{\mathsf{add}}
\newcommand{\Nmul}{\mathsf{mul}}

\begin{document}

\title{Introduction to homotopy type theory: practice exam}
\author{DAT235/DIT577/PhD reading course}
\date{2023, December 23}

\maketitle

\begin{itemize}
\item
Grade scale:\qquad
\begin{tabularx}{10cm}{|c|Y|Y|Y|Y|}
  \hline
  Fraction of points & $\geq 0$ & $\geq 2/5$ & $\geq 3/5$ & $\geq 4/5$
  \\\hline
  Grade & U & 3 & 4 & 5
  \\\hline
\end{tabularx}
\item
Time: 4 hours
\item
No aids allowed.
\item
You may use familiar facts from the course book or our discussions without justification, provided they do not already include the statement to be proven or depend on it.
\item
The axioms of function extensionality and univalence may only be used where stated. 
\end{itemize}

\newpage

\begin{enumerate}

\item \label{ackermann-pattern-matching}
\textbf{[4 points]}
Recall that the type $\N$ of natural numbers is inductively generated by $0 : \N$ and $S(n) : \N$ for $n : \N$.
Its eliminator (induction) takes a family $P$ over $\N$ with
\begin{itemize}
\item
$z : P(0)$,
\item
$s(n, x) : P(\Nsucc(n))$ for $n : \N$ and $x : P(n)$,
\end{itemize}
and gives $\ind_{P,z,s}(n) : P(n)$ for $n : \N$.

Justify the definition of $f : \N \times \N \to \N$ by pattern matching
\begin{align*}
f(0, b) &= \Nsucc(b)
\\
f(\Nsucc(a), 0) &= f(a, \Nsucc(0))
\\
f(\Nsucc(a), \Nsucc(b)) &= f(a, f(\Nsucc(a), b))
\end{align*}
by translating it to a definition using the eliminator instead.

\item \label{contractible-example}
\textbf{[4 points]}
Let $A$ be a type with an element $a$.
Consider the following type:
\[
\sum_{x : A} \sum_{p : a = x} \sum_{q : x = a} p \cdot q = \refl_a
\]
Is this type always contractible? If yes, prove so; if no, provide a counterexample.

\item \label{retract-contractible}
\textbf{[4 points]}
A type $A$ is a \emph{retract} of a type $B$ if we have $s : A \to B$ and $r : B \to A$ with $r s \sim \id_A$.
Prove that any retract of a contractible type is again contractible.

\item \label{2-out-of-6}
\textbf{[4 points]}
Consider maps
\[
\begin{tikzcd}
  A
  \ar{r}{f}
&
  B
  \ar{r}{g}
&
  C
  \ar{r}{h}
&
  D
\rlap{.}
\end{tikzcd}
\]
Assume that $g \circ f$ and $h \circ g$ are bi-invertible.
Show that $f$, $g$, $h$ are all bi-invertible.

\item \label{biinvertible-is-contractible}
\textbf{[8 points in total]}
One of the most technical parts in the setup of homotopy type theory is the proof that bi-invertible maps are contractible.
In this problem, we will work through an alternative approach from discussions with David WÃ¤rn.

We start with maps $g : B \to A$ and $f, h : A \to B$ with $p : g \circ f \sim \id_A$ and $q : h \circ g \sim \id_B$.
Prove the following sequence of claims.
You may use all previous problems and parts.
\begin{enumerate}
\item
\textbf{[2 points]}
The following maps are bi-invertible:
\begin{itemize}
\item $\ap_{g \circ f}^{a_0, a_1} : (a_0 = a_1) \to (g(f(a_0)) = g(f(a_1)))$ for $a_0, a_1 : A$,
\item $\ap_{h \circ g}^{b_0, b_1} : (b_0 = b_1) \to (h(g(b_0)) = h(g(b_1)))$ for $b_0, b_1 : B$.
\end{itemize}
You may use function extensionality here.
\item
\textbf{[2 points]}
The map $\ap_f^{a_0, a_1} : (a_0 = a_1) \to (f(a_0) = f(a_1))$ is bi-invertible for $a_0, a_1 : A$.
\item
\textbf{[2 points]}
For $a_0 : A$, the type $\sum_{a_1:A} f(a_0) = f(a_1)$ is contractible.
\item
\textbf{[2 points]}
The map $f$ is contractible.
\end{enumerate}

\item \label{univalence}
\textbf{[4 points]}
Define what it means for a universe $\U$ to be univalent. 

\end{enumerate}

\end{document}
